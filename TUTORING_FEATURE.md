# 輔導預約功能說明

## 功能概述

輔導預約功能採用老師建立時段、學生選擇時段的模式，確保輔導時間的有效管理和預約的準確性。

## 功能特色

### 老師端功能
1. **萬年月曆系統**
   - 直觀的月曆介面，支援年月切換
   - 不包含當天，開放後14天可建立時段
   - 點擊日期即可建立輔導時段

2. **時段管理**
   - 建立輔導時段（時間、時長、名額）
   - 查看已建立的時段
   - 管理時段狀態（可預約、已滿、已取消）

3. **預約管理**
   - 查看所有學生的預約申請
   - 確認或拒絕預約申請
   - 標記預約為已完成
   - 刪除預約記錄

4. **統計資訊**
   - 待確認預約數量
   - 已確認預約數量
   - 已完成預約數量
   - 已取消預約數量

### 學生端功能
1. **月曆瀏覽**
   - 查看老師建立的輔導時段
   - 直觀的日期選擇介面
   - 即時顯示可用時段數量

2. **時段選擇**
   - 選擇老師已建立的輔導時段
   - 查看時段詳細資訊（時間、老師、名額）
   - 選擇輔導科目和添加備註

3. **預約記錄**
   - 查看所有預約申請的狀態
   - 統計各狀態的預約數量
   - 查看預約詳細資訊

## 預約狀態說明

- **待確認**：學生已提交預約申請，等待老師回覆
- **已確認**：老師已確認預約申請
- **已完成**：輔導課程已完成
- **已取消**：預約已被取消

## 時段狀態說明

- **可預約**：時段開放預約，有名額
- **已滿**：時段名額已滿
- **已取消**：時段已被取消

## 輔導性質

### 個人輔導
- **人數限制**：1-5人
- **適用場景**：一對一或小班制輔導
- **特點**：更專注的個人化指導

### 團體輔導
- **人數限制**：不限制人數（系統自動設定為999）
- **適用場景**：大班制輔導
- **特點**：適合團體學習和討論

## 限制設定規則

### 科目限制
- **固定科目選項**：數學、理化、物理、化學、生物
- 選擇科目後會自動清空課程選擇
- 科目和課程限制必須至少選擇其中一項

### 課程限制
- 可多選系統中的課程
- 選擇科目時課程選擇會被停用
- 支援多個課程同時限制

## 使用流程

### 老師建立時段
1. 登入老師帳號
2. 點擊「輔導預約管理」
3. 選擇「建立時段」標籤
4. 在月曆中點擊要建立時段的日期
5. 填寫時段資訊：
   - 選擇時間
   - 設定時長（30分鐘、60分鐘、90分鐘、120分鐘）
   - 設定最大學生數
6. 點擊「新增」完成建立

### 學生預約輔導
1. 登入學生帳號
2. 點擊「輔導預約」
3. 選擇「申請預約」
4. 在月曆中選擇有可用時段的日期
5. 選擇想要的輔導時段
6. 選擇輔導科目
7. 填寫備註（可選）
8. 提交申請

### 老師管理預約
1. 登入老師帳號
2. 點擊「輔導預約管理」
3. 選擇「預約記錄」標籤
4. 查看預約列表
5. 對待確認的預約進行操作：
   - 點擊「確認」接受預約
   - 點擊「拒絕」取消預約
6. 對已確認的預約點擊「完成」標記為已完成

## 資料庫結構

### time-slots 集合（時段）
```javascript
{
  id: "時段ID",
  teacherId: "老師ID",
  teacherName: "老師姓名",
  date: "日期",
  time: "時間",
  duration: 60, // 時長（分鐘）
  maxStudents: 1, // 最大學生數
  currentStudents: 0, // 當前預約學生數
  status: "available|full|cancelled",
  restrictions: "限制說明", // 額外限制說明
  notes: "備註", // 輔導內容、注意事項等
  tutoringType: "individual|group", // 輔導性質
  subjectRestriction: "科目名稱", // 科目限制
  courseRestrictions: ["課程ID1", "課程ID2"], // 課程限制
  createdAt: Timestamp
}
```

### tutoring-sessions 集合（預約）
```javascript
{
  id: "預約ID",
  studentId: "學生ID",
  studentName: "學生姓名",
  studentUsername: "學生帳號",
  teacherId: "老師ID",
  teacherName: "老師姓名",
  subject: "輔導科目",
  date: "預約日期",
  time: "預約時間",
  duration: 60, // 時長（分鐘）
  notes: "備註",
  status: "pending|confirmed|completed|cancelled",
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

## 技術實現

### 前端組件
- `Calendar.tsx` - 萬年月曆組件
- `TutoringManager.tsx` - 老師端預約管理
- `TutoringRequest.tsx` - 學生端預約申請
- `StudentTutoringHistory.tsx` - 學生端預約記錄
- `ConfirmDialog.tsx` - 確認對話框

### 主要功能
- 使用 Firebase Firestore 儲存時段和預約資料
- 即時更新時段和預約狀態
- 響應式設計，支援各種螢幕尺寸
- 完整的錯誤處理和載入狀態
- 萬年月曆系統，支援年月切換

## 時段建立規則

1. **時間限制**：包含當天，開放後14天可建立時段
2. **時長選項**：30分鐘、60分鐘、90分鐘、120分鐘
3. **時間選項**：09:00、10:00、11:00、14:00、15:00、16:00、19:00、20:00
4. **人數限制**：
   - 個人輔導：1-5名學生（需要設定）
   - 團體輔導：不限制人數（自動隱藏人數設定）
5. **狀態管理**：自動根據預約人數更新時段狀態
6. **限制設定**：必須選擇科目或課程限制（至少一項）
7. **備註功能**：可添加輔導內容、注意事項等說明

## 新增輔導時段功能

### 必填欄位
- **日期**：從日曆點擊時自動帶入，包含當天，開放後14天
- **輔導性質**：個人輔導或團體輔導
- **輔導時間**：選擇具體時間點
- **時長**：30分鐘、60分鐘、90分鐘、120分鐘
- **最大學生數**：僅個人輔導需要設定（1-5人）
- **限制設定**：科目或課程限制（至少選擇一項）

### 自動帶入欄位
- **老師**：系統自動帶入當前登入老師資訊

### 選填欄位
- **備註**：輔導內容、注意事項或其他說明

## 科目選項
系統提供以下固定科目選項：
- **數學**：數學相關輔導
- **理化**：理化綜合輔導
- **物理**：物理專科輔導
- **化學**：化學專科輔導
- **生物**：生物專科輔導

## 注意事項

1. 老師必須先建立時段，學生才能預約
2. 時段建立後無法修改，如需變更請刪除重建
3. 學生只能選擇可預約的時段
4. 時段名額滿後自動變為「已滿」狀態
5. 老師會在24小時內回覆預約申請
6. 請準時參加輔導，遲到可能影響輔導時間

## 未來擴展

- 添加時段批量建立功能
- 支援時段重複建立（每週固定時段）
- 添加預約提醒功能
- 支援線上輔導會議連結
- 添加輔導評價系統
- 支援時段衝突檢測
- 添加時段模板功能

## 編輯和刪除功能

### 編輯時段
- 在時段卡片上點擊編輯圖示（鉛筆圖示）
- 在編輯對話框中修改時段資訊
- 點擊「更新」按鈕保存變更

### 刪除時段
- 在時段卡片上點擊刪除圖示（垃圾桶圖示）
- 在確認對話框中點擊「確認刪除」
- 時段將被永久刪除

## 輔導方式說明

### 線上輔導
- 老師選擇「線上輔導」時，學生必須填寫電子郵件地址
- 系統會自動帶入學生資料庫中的郵件地址，但學生可以編輯
- 老師將透過電子郵件與學生聯繫進行輔導

### 實體輔導
- 老師選擇「實體輔導」時，必須填寫輔導地點
- 學生在預約時可以看到輔導地點
- 學生需要準時前往指定地點參加輔導

## 注意事項
1. 團體輔導不限制學生人數，系統會自動設定為999人
2. 科目限制和課程限制不能同時設定
3. 刪除時段操作無法復原
4. 編輯時段時會保留原有的預約記錄
5. 時段狀態會根據當前學生數自動更新
6. 線上輔導必須填寫電子郵件地址
7. 實體輔導必須填寫輔導地點
8. 時段卡片已優化為更大的顯示格式，提供更好的視覺體驗

## 技術實現
- 前端：React + TypeScript + Tailwind CSS
- 後端：Firebase Firestore
- 狀態管理：React Hooks
- 路由：Next.js App Router 